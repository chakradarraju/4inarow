(this.webpackJsonp4inarow=this.webpackJsonp4inarow||[]).push([[0],{20:function(e,n,t){e.exports=t(44)},25:function(e,n,t){},26:function(e,n,t){},27:function(e,n,t){},28:function(e,n,t){},43:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=43},44:function(e,n,t){"use strict";t.r(n);var r={};t.r(r),t.d(r,"onExit",(function(){return C})),t.d(r,"highlight",(function(){return N})),t.d(r,"sendMessage",(function(){return O})),t.d(r,"sentMessage",(function(){return S})),t.d(r,"receiveMessage",(function(){return b})),t.d(r,"ackMessage",(function(){return _})),t.d(r,"addPiece",(function(){return I})),t.d(r,"checkEnd",(function(){return T})),t.d(r,"togglePlayer",(function(){return w})),t.d(r,"setHostId",(function(){return k})),t.d(r,"removeHostId",(function(){return j})),t.d(r,"setNetworkGame",(function(){return M})),t.d(r,"updateClientId",(function(){return G})),t.d(r,"resetServerConnection",(function(){return R})),t.d(r,"successfulServerConnection",(function(){return A})),t.d(r,"resetPeerConnection",(function(){return P})),t.d(r,"successfulPeerConnection",(function(){return D})),t.d(r,"setPlayer1Name",(function(){return H})),t.d(r,"setPlayer2Name",(function(){return L})),t.d(r,"startGame",(function(){return x})),t.d(r,"exitGame",(function(){return U}));var a={};t.r(a),t.d(a,"myClientId",(function(){return te})),t.d(a,"gameStarted",(function(){return re})),t.d(a,"gameId",(function(){return ae})),t.d(a,"networkGame",(function(){return oe})),t.d(a,"cells",(function(){return ie})),t.d(a,"gameResult",(function(){return se})),t.d(a,"player1Turn",(function(){return fe})),t.d(a,"outMessages",(function(){return me})),t.d(a,"inMessages",(function(){return Ee})),t.d(a,"hostId",(function(){return pe})),t.d(a,"serverConnected",(function(){return ge})),t.d(a,"peerConnected",(function(){return ve})),t.d(a,"player1Name",(function(){return ye})),t.d(a,"player2Name",(function(){return he}));var o=t(0),c=t.n(o),u=t(8),l=t.n(u),i=(t(25),t(26),t(3));t(27);var s=function(e){var n=e.enable?{onMouseEnter:e.onHover,onClick:e.onClick}:{};return c.a.createElement("div",Object.assign({},n,{className:"cell "+e.type}))};var f=function(e){var n=function(n){return function(){return e.onHover(n)}},t=function(n){return function(){return e.onClick(n)}};return e.cells.map((function(r,a){return c.a.createElement("div",{key:a},r.map((function(r,a){return c.a.createElement(s,{type:r,key:a,enable:e.enable,onClick:t(a),onHover:n(a)})})))}))},d=(t(28),t(15)),m=t(16);function E(e){return e?"b":"c"}var p=E(!0),g=function(){function e(){Object(d.a)(this,e),this.reset(),this.result=0}return Object(m.a)(e,[{key:"reset",value:function(){this.count=0,this.prevColor="a"}},{key:"inc",value:function(){this.count++,4===this.count&&this.setWinner()}},{key:"setWinner",value:function(){this.result=this.prevColor===p?2:3}},{key:"updateColor",value:function(e){this.prevColor=e,this.count=1}},{key:"put",value:function(e){return"a"===e?this.reset():e===this.prevColor?this.inc():this.updateColor(e),this.result}}]),e}();var v=function(e){var n=e.length,t=e[0].length,r=new g;if(function(e,n,t){for(var r=0;r<n;r++)for(var a=0;a<t;a++)if("a"===e[r][a])return!1;return!0}(e,n,t))return 1;for(var a=0;a<n;a++){r.reset();for(var o=0;o<t;o++)if(0!==r.put(e[a][o]))return r.result}for(o=0;o<t;o++){r.reset();for(a=0;a<n;a++)if(0!==r.put(e[a][o]))return r.result}for(var c=0;c<n+t;c++){r.reset();for(a=0;a<n;a++){var u=c-a;if(!(u<0||u>=t)&&0!==r.put(e[a][u]))return r.result}}for(c=-n;c<t;c++){r.reset();for(a=0;a<n;a++){var l=c+a;if(!(l<0||l>=t)&&0!==r.put(e[a][l]))return r.result}}return 0},y=t(1),h=t(10),C=function(){return{type:"EXIT_GAME"}},N=function(e,n){return{type:"HIGHLIGHT",j:e,color:n}},O=function(e,n){return{type:"SEND_MESSAGE",msg:e,data:n,id:h.generate()}},S=function(e){return{type:"SENT_MESSAGE",id:e.id}},b=function(e,n){return{type:"RECEIVED_MESSAGE",msg:e,data:n,id:h.generate()}},_=function(e){return{type:"ACK_MESSAGE",id:e.id}},I=function(e,n){return{type:"ADD_PIECE",j:e,color:n}},T=function(e){return{type:"CHECK_END",cells:e}},w=function(){return{type:"TOGGLE_PLAYER"}},k=function(e){return{type:"SET_HOST",hostId:e}},j=function(){return{type:"REMOVE_HOST"}},M=function(e){return{type:"SET_NETWORK_GAME",isNetworkGame:e}},G=function(e){return{type:"UPDATE_CLIENT_ID",clientId:e}},R=function(){return{type:"RESET_SERVER_CONNECTION"}},A=function(){return{type:"SUCCESSFUL_SERVER_CONNECTION"}},P=function(){return{type:"RESET_PEER_CONNECTION"}},D=function(){return{type:"SUCCESSFUL_PEER_CONNECTION"}},H=function(e){return{type:"SET_PLAYER1_NAME",name:e}},L=function(e){return{type:"SET_PLAYER2_NAME",name:e}},x=function(){return{type:"GAME_STARTED"}},U=function(){return{type:"SHOW_START_SCREEN"}};var F=Object(y.b)((function(e){return e}),r)((function(e){var n=!e.hostId;function t(n){e.addPiece(n,E(e.player1Turn)),e.checkEnd(e.cells),0===e.gameResult&&e.togglePlayer()}return Object(o.useEffect)((function(){var n,r=Object(i.a)(e.inMessages);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.ack||"select"!==a.msg||(t(a.data),e.ackMessage(a))}}catch(o){r.e(o)}finally{r.f()}}),[e.inMessages]),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"users"},c.a.createElement("span",{className:"you"},c.a.createElement(s,{type:E(!0)}),e.player1Name),c.a.createElement("span",{className:"opponent"},e.player2Name,c.a.createElement(s,{type:E(!1)}))),c.a.createElement("div",{className:"message"},1===e.gameResult?"Tie":2===e.gameResult?e.player1Name+" won":3===e.gameResult?e.player2Name+" won":e.networkGame&&!e.peerConnected?(n?e.player2Name:e.player1Name)+" disconnected":e.player1Turn?e.player1Name+" turn":e.player2Name+" turn"),c.a.createElement("button",{onClick:e.exitGame},"Exit"),c.a.createElement("div",{style:{margin:"30px"}},c.a.createElement(f,{enable:0===e.gameResult&&(!e.networkGame||e.peerConnected&&n===e.player1Turn),cells:e.cells,onHover:function(n){e.highlight(n,E(e.player1Turn))},onClick:function(n){e.networkGame&&e.sendMessage("select",n),t(n)}})))})),W=t(2),V=t(10);var Y=Object(y.b)((function(e){return e}),r)((function(e){var n=Object(o.useRef)(),t=window.location+"#"+function(){var n=V.generate();return e.myClientId+"/"+n}(),r=Object(o.useState)(!1),a=Object(W.a)(r,2),u=a[0],l=a[1],s=Object(o.useState)(!1),f=Object(W.a)(s,2),d=f[0],m=f[1];function E(){return window.location.hash&&window.location.hash.length>0}function p(n){if("ask-player1-name"===n.msg)e.sendMessage("player1-name",e.player1Name);else if("ask-player2-name"===n.msg)e.sendMessage("player2-name",e.player2Name);else if("player1-name"===n.msg)e.hostId&&e.setPlayer1Name(n.data);else if("player2-name"===n.msg)e.hostId||e.setPlayer2Name(n.data);else if("peer-started"===n.msg)console.log("Got peer started"),m(!0);else{if("ask-peer-started"!==n.msg)return;console.log("Got peer started ask"),u&&e.sendMessage("peer-started",!0)}e.ackMessage(n)}return Object(o.useEffect)((function(){e.setNetworkGame(E())}),[]),Object(o.useEffect)((function(){if(e.inMessages){var n,t=Object(i.a)(e.inMessages);try{for(t.s();!(n=t.n()).done;){var r=n.value;r.ack||p(r)}}catch(a){t.e(a)}finally{t.f()}}}),[e.inMessages,e.hostId]),Object(o.useEffect)((function(){if(E()){var n=function(e){console.log("Parsing game str",e);var n=e.split("/");return 2===n.length?n:[null,null]}(window.location.hash.substr(1)),t=Object(W.a)(n,2),r=t[0];t[1];if(null===r)return void console.log("Invalid game str");e.setHostId(r)}else e.removeHostId()}),[e.serverConnected]),Object(o.useEffect)((function(){e.peerConnected&&(e.setNetworkGame(!0),e.hostId?e.sendMessage("ask-player1-name",{}):e.sendMessage("ask-player2-name",{}))}),[e.peerConnected]),Object(o.useEffect)((function(){e.networkGame&&!e.hostId&&e.sendMessage("player1-name",e.player1Name)}),[e.player1Name]),Object(o.useEffect)((function(){e.networkGame&&e.hostId&&e.sendMessage("player2-name",e.player2Name)}),[e.player2Name]),Object(o.useEffect)((function(){u&&e.sendMessage("peer-started",{})}),[u]),Object(o.useEffect)((function(){u&&(d?e.startGame():e.sendMessage("ask-peer-started",{}))}),[u,d]),c.a.createElement("div",{style:{margin:"30px"}},c.a.createElement("div",{style:{margin:"30px"}},c.a.createElement("button",{style:{padding:e.networkGame?"":"5px"},onClick:function(){return e.setNetworkGame(!1)}},"Local game"),c.a.createElement("button",{style:{padding:e.networkGame?"5px":""},onClick:function(){return e.setNetworkGame(!0)}},"Network game")),!e.networkGame&&c.a.createElement(c.a.Fragment,null,"Update your names and hit start to play!",c.a.createElement("br",null),c.a.createElement("br",null),"Player 1: ",e.player1Name,c.a.createElement("button",{onClick:function(){return e.setPlayer1Name(prompt("Player 1 name"))}},"Change"),c.a.createElement("br",null),"Player 2: ",e.player2Name,c.a.createElement("button",{onClick:function(){return e.setPlayer2Name(prompt("Player 2 name"))}},"Change"),c.a.createElement("br",null),c.a.createElement("button",{style:{margin:"30px"},onClick:e.startGame},"Start")),e.networkGame&&c.a.createElement(c.a.Fragment,null,!e.serverConnected&&c.a.createElement("div",null,"Connecting to server..."),e.serverConnected&&!e.hostId&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{style:{margin:"20px"}},c.a.createElement("div",null,"Name: ",e.player1Name,c.a.createElement("button",{onClick:function(){return e.setPlayer1Name(prompt("Your name"))}},"Change")),c.a.createElement("div",null,"Opponent name: ",e.player2Name)),!e.peerConnected&&c.a.createElement(c.a.Fragment,null,"Ask your friend to open:",c.a.createElement("br",null),c.a.createElement("input",{ref:n,readOnly:!0,value:t}),c.a.createElement("button",{onClick:function(){n&&n.current&&(n.current.select(),document.execCommand("copy"),alert("Copied, now send it to your friend"))}},"Copy"),c.a.createElement("div",null,"Waiting for peer..."))),e.serverConnected&&e.hostId&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{style:{margin:"20px"}},c.a.createElement("div",null,"Name: ",e.player2Name,c.a.createElement("button",{onClick:function(){return e.setPlayer2Name(prompt("Your name"))}},"Change")),c.a.createElement("div",null,"Opponent name: ",e.player1Name)),!e.peerConnected&&c.a.createElement(c.a.Fragment,null,"Connecting to host...")),e.serverConnected&&e.peerConnected&&u&&c.a.createElement("div",null,"Waiting for peer to start..."),e.serverConnected&&e.peerConnected&&!u&&c.a.createElement("button",{onClick:function(){return l(!0)}},"Start")))})),K=t(18),X=t.n(K),B=t(10),J={secure:"https:"===window.location.protocol};var $=Object(y.b)((function(e){return e}),r)((function(e){var n=Object(o.useState)(null),t=Object(W.a)(n,2),r=t[0],a=t[1],c=Object(o.useState)(null),u=Object(W.a)(c,2),l=u[0],s=u[1],f=Object(o.useState)(null),d=Object(W.a)(f,2),m=d[0],E=d[1],p=Object(o.useState)(null),g=Object(W.a)(p,2),v=g[0],y=g[1],h=Object(o.useState)(!0),C=Object(W.a)(h,2),N=C[0],O=C[1];function S(){e.hostId?E(r.connect(e.hostId,{metadata:{peerId:e.myClientId},reliable:!0})):console.log("hostId missing",e.hostId)}return Object(o.useEffect)((function(){var n=localStorage.getItem("client-id"),t=n||B.generate();localStorage.setItem("client-id",t),e.updateClientId(t)}),[]),Object(o.useEffect)((function(){e.myClientId?(console.log("Connecting to server with",e.myClientId),a(new X.a(e.myClientId,J))):console.log("Not creating connection to server",e.myClientId)}),[e.myClientId]),Object(o.useEffect)((function(){r&&!r.disconnected||(e.resetServerConnection(),setTimeout((function(){r&&r.disconnected&&(console.log("Trying to reconnect to server..."),r.reconnect())}),1e3)),l&&-1!==l.message.indexOf("Could not connect to peer")&&S()}),[l]),Object(o.useEffect)((function(){e.serverConnected&&s(null)}),[e.serverConnected]),Object(o.useEffect)((function(){if(r)return console.log("Setting up server connection"),e.resetServerConnection(),r.on("open",(function(n){e.successfulServerConnection()})),r.on("error",(function(e){console.error("Got server error",e),s(e)})),r.on("connection",(function(e){E(e)})),function(){r.off("open"),r.off("error"),r.off("connection")};console.log("Skipping event handlers on invalid serverconnection",null)}),[r]),Object(o.useEffect)((function(){if(m)return m.on("open",(function(){console.log("peer connected"),e.successfulPeerConnection()})),m.on("data",(function(n){console.log("Received message",n),e.receiveMessage(n.msg,n.data)})),m.on("error",(function(n){console.error("Peer connection error",n),y(n),e.resetPeerConnection()})),function(){m.off("open"),m.off("data"),m.off("error")};console.log("no peer connection")}),[m]),Object(o.useEffect)((function(){v&&-1!==v.message.indexOf("disconnected")&&N&&setTimeout((function(){console.log("Trying to reconnect...",e.hostId),S()}),1e3)}),[v]),Object(o.useEffect)((function(){e.peerConnected&&y(null)}),[e.peerConnected]),Object(o.useEffect)((function(){r&&e.serverConnected?e.hostId&&(O(!0),S()):console.log("Not connected to server, skipping connecting to host",e.hostId,r,e.serverConnected)}),[r,e.serverConnected,e.hostId]),Object(o.useEffect)((function(){if(e.peerConnected){var n,t=Object(i.a)(e.outMessages);try{for(t.s();!(n=t.n()).done;){var r=n.value;r.sent||(m.send({msg:r.msg,data:r.data}),e.sentMessage(r))}}catch(a){t.e(a)}finally{t.f()}}else console.log("Unable to send message")}),[e.outMessages,e.peerConnected]),null}));var q=Object(y.b)((function(e){return e}))((function(e){return c.a.createElement("div",{className:"App"},c.a.createElement($,null),c.a.createElement("div",{className:"title"},"4 IN A ROW"),c.a.createElement("div",null,!e.gameStarted&&c.a.createElement(Y,null),e.gameStarted&&c.a.createElement(F,null)))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var z=t(6),Q=t(19),Z=t(9),ee=function(){return Object(Z.a)(Array(6)).map((function(e){return new Array(7).fill("a")}))},ne=ee();function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"UPDATE_CLIENT_ID":return n.clientId;default:return e}}function re(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"GAME_STARTED":return!0;case"SHOW_START_SCREEN":return!1;default:return e}}function ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_GAME_ID":return n.gameId;default:return e}}function oe(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_NETWORK_GAME":return n.isNetworkGame;default:return e}}function ce(e,n){for(var t=5;t>=0&&"a"!==e[t][n];)t--;return t}function ue(e,n){for(var t=0;t<6;t++)for(var r=0;r<7;r++)e[t][r]===n&&(e[t][r]="a")}function le(e,n){ue(e,n.color+"l");var t=ce(e,n.j);return t<0?(console.log("Column does not have empty cell"),e):(e[t][n.j]=n.color,e.slice())}function ie(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"ADD_PIECE":return le(e,n);case"HIGHLIGHT":ue(e,n.color+"l");var t=ce(e,n.j);return t<0?e:(e[t][n.j]=n.color+"l",e.slice());case"GAME_STARTED":return ee();default:return e}}function se(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"CHECK_END":return v(n.cells);case"GAME_STARTED":return 0;default:return e}}function fe(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"TOGGLE_PLAYER":return!e;case"GAME_STARTED":return!0;default:return e}}function de(e,n,t,r){return e.map((function(e){return function(e,n,t,r){if(e.id!==n)return e;var a=Object(Q.a)({},e);return a[t]=r,a}(e,n,t,r)}))}function me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SEND_MESSAGE":return[].concat(Object(Z.a)(e),[{id:n.id,msg:n.msg,data:n.data}]);case"SENT_MESSAGE":return de(e,n.id,"sent",!0);default:return e}}function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"RECEIVED_MESSAGE":return[].concat(Object(Z.a)(e),[{id:n.id,msg:n.msg,data:n.data}]);case"ACK_MESSAGE":return de(e,n.id,"ack",!0);default:return e}}function pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_HOST":return n.hostId;case"REMOVE_HOST":return null;default:return e}}function ge(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"RESET_SERVER_CONNECTION":return!1;case"SUCCESSFUL_SERVER_CONNECTION":return!0;default:return e}}function ve(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"RESET_PEER_CONNECTION":return!1;case"SUCCESSFUL_PEER_CONNECTION":return!0;default:return e}}function ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Player 1",n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_PLAYER1_NAME":return n.name;default:return e}}function he(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Player 2",n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_PLAYER2_NAME":return n.name;default:return e}}var Ce=Object(z.c)(Object(z.b)(a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(y.a,{store:Ce},c.a.createElement(q,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[20,1,2]]]);
//# sourceMappingURL=main.587e45c4.chunk.js.map